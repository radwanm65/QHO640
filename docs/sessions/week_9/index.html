<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Week 9 - Managing Data Using Firebase</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/web-dev-2022-notes/assets/css/0.styles.082ab4f7.css" as="style"><link rel="preload" href="/web-dev-2022-notes/assets/js/app.533af2e4.js" as="script"><link rel="preload" href="/web-dev-2022-notes/assets/js/2.dc3a9f95.js" as="script"><link rel="preload" href="/web-dev-2022-notes/assets/js/17.d3da4c0b.js" as="script"><link rel="preload" href="/web-dev-2022-notes/assets/js/18.86fcf28e.js" as="script"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/10.ab1164cb.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/11.d1dc547c.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/12.175eb028.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/13.19cf8fc5.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/14.cf89cf35.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/15.a43a422b.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/16.531a69b4.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/19.c78b6bae.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/20.4c8cdc86.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/21.4bc413c1.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/22.1ecbd3ce.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/23.500ca56e.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/24.8832781e.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/25.9113dd73.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/26.9d001e96.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/27.77ebcbaf.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/28.c0e6e8f3.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/29.bb340f0e.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/3.fdf3985a.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/30.a09d2f35.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/31.bb9b5555.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/32.c3afc18f.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/33.cdc7b86c.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/34.14f1c7f7.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/35.b426ef2a.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/36.e9443ce3.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/37.14cad322.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/38.05b01327.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/39.28e299d9.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/4.e77bc45c.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/40.397fecf5.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/41.b9a74a19.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/42.f0dd2bc1.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/43.1dd708e5.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/44.2af3b1b3.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/45.ef0305f7.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/46.73303f18.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/5.e5b5458e.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/6.28ea1ad6.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/7.8bcd5d4c.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/8.e697c017.js"><link rel="prefetch" href="/web-dev-2022-notes/assets/js/9.b6918f12.js">
    <link rel="stylesheet" href="/web-dev-2022-notes/assets/css/0.styles.082ab4f7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/web-dev-2022-notes/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Assessments</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 1 - The latest version of JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 2 - Introducing React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 3 - Loops</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 4 - Styles</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 5 - Design Thinking Workshop</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 6 - State And Routes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 7 -  Forms,Validation and Conditional Rendering</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 8 -  Firebase Authentication and Custom Hooks</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Week 9 -  Managing Data In Firebase</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web-dev-2022-notes/sessions/week_9/lecture.html" class="sidebar-link">Lecture (Start Here)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/lecture.html#solution-video-week-8" class="sidebar-link">Solution Video Week 8</a></li></ul></li><li><a href="/web-dev-2022-notes/sessions/week_9/" aria-current="page" class="active sidebar-link">Week 9 - Managing Data Using Firebase</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/#session-dependencies" class="sidebar-link">Session Dependencies</a></li><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/#a-little-bit-about-the-firestore-database" class="sidebar-link">A little bit about the Firestore database</a></li><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/#setting-up-the-firestore-database" class="sidebar-link">Setting up the Firestore Database</a></li><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/#task-1-setting-up-a-database" class="sidebar-link">Task 1 - Setting up a database</a></li><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/#structuring-data" class="sidebar-link">Structuring Data</a></li><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/#task-2-exploring-the-check-in-data" class="sidebar-link">Task 2 - Exploring the check-in data</a></li><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/#task-3-denormalisation-of-the-checkin-data" class="sidebar-link">Task 3 - Denormalisation of the checkin data</a></li><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/#reading-and-writing-to-our-database" class="sidebar-link">Reading and Writing to Our Database</a></li><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/#writing-data-to-firestore" class="sidebar-link">Writing Data to Firestore</a></li><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/#task-4-make-your-first-database-write" class="sidebar-link">Task 4 - Make your first database write</a></li><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/#reading-checkin-data" class="sidebar-link">Reading Checkin Data</a></li><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/#home-study" class="sidebar-link">Home Study</a></li><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/#task-5-display-the-checkin-data" class="sidebar-link">Task 5 - Display the checkin data</a></li><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/#task-7-advanced" class="sidebar-link">Task 7 (Advanced)</a></li><li class="sidebar-sub-header"><a href="/web-dev-2022-notes/sessions/week_9/#solution-video" class="sidebar-link">Solution Video</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 10 -  Hosting, Rules and Cloud Functions</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="week-9-managing-data-using-firebase"><a href="#week-9-managing-data-using-firebase" class="header-anchor">#</a> Week 9 - Managing Data Using Firebase</h1> <p>This week, we continue our journey into the the wonderful world of serverless. We will be considering how we can use the firebase document database, <a href="https://firebase.google.com/docs/firestore" target="_blank" rel="noopener noreferrer">firestore<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>In doing so, we will be answering the following question?</p> <h3 id="how-can-i-persist-data-in-my-web-applications"><a href="#how-can-i-persist-data-in-my-web-applications" class="header-anchor">#</a> How can I persist data in my web applications?</h3> <div class="custom-block warning"><p class="custom-block-title">session dependencies</p> <h2 id="session-dependencies"><a href="#session-dependencies" class="header-anchor">#</a> Session Dependencies</h2> <p>Make sure that you have the latest of the ongoing class, fitness tracker, project. The notes for this week refer extensively to this project:</p> <p><code>git clone -b week-8-solutions https://github.com/joeappleton18/running-contemp-web-app-solutions.git</code></p> <p>Moving forward, due to having to integrate with firebase, setups are a little more involved. You will need to ensure that you add your own firebase credentials. The <code>README.md</code> file on my version of the fitness tracker walks you through how to do this.</p></div> <h3 id="essential-reading"><a href="#essential-reading" class="header-anchor">#</a> Essential Reading 📕</h3> <div class="custom-block warning"><p class="custom-block-title">essential reading</p> <ul><li><a href="https://firebase.google.com/docs/firestore" target="_blank" rel="noopener noreferrer">The cloud firestore overview<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://firebase.google.com/docs/firestore/data-model" target="_blank" rel="noopener noreferrer">The cloud firestore data model<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>This week, we are going to be exploring cloud Firestore, the database offering by Firebase. Out of the box, we get a powerful, scalable database.</p> <div class="custom-block warning"><p class="custom-block-title">tip</p> <p>Do not confuse Firestore with the Realtime Database. The Realtime database is a older, more simplistic, database product. For new projects you should be using Firestore.</p></div> <h2 id="a-little-bit-about-the-firestore-database"><a href="#a-little-bit-about-the-firestore-database" class="header-anchor">#</a> A little bit about the Firestore database</h2> <p>Cloud Firestore is a NoSQL, document-oriented database. There are three main types of NoSQL-databases: document-based, column-based and graph-base. Cloud Firestore is of the document-based variety.</p> <p>In a document-based database, your application's data is stored in documents in a JSON like structure. Documents live in collections. If you come from a relational database world, collections are like tables. If your application requires it, you can also structure sub-collections within documents. We will explore how this works through examples. As this is not a database unit, I am not overly focusing on data modeling.</p> <p>One of the fundamental rules of non-relational data modeling is we try and represent data from a user-first perspective. In other words, we want to structure our data so it can be simply displayed in our application's users interface.</p> <h2 id="setting-up-the-firestore-database"><a href="#setting-up-the-firestore-database" class="header-anchor">#</a> Setting up the Firestore Database</h2> <p><img src="/web-dev-2022-notes/assets/img/fig_1.859ae8a2.png" alt=""></p> <blockquote><blockquote><p>Figure 1, creating a database</p></blockquote></blockquote> <p>Creating a database for your project is simple:</p> <ul><li><p>In your firebase project, select Database from the left-hand-side, develop menu section</p></li> <li><p>Next, click the <code>create database</code></p></li> <li><p>We want to start off in test mode, so select this option when prompted</p></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <h2 id="task-1-setting-up-a-database"><a href="#task-1-setting-up-a-database" class="header-anchor">#</a> Task 1 - Setting up a database</h2> <p>Follow the steps above to set up your database - ensure that you set it up in &quot;test&quot; mode.</p></div> <h2 id="structuring-data"><a href="#structuring-data" class="header-anchor">#</a> Structuring Data</h2> <p>Remember, the data in our database is created from the perspective of a user. To highlight this point let's consider, first, our check-in functionality and data that it outputs.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <h2 id="task-2-exploring-the-check-in-data"><a href="#task-2-exploring-the-check-in-data" class="header-anchor">#</a> Task 2 - Exploring the check-in data</h2> <ul><li>Log-in to your application</li> <li>Navigate to the <code>/checkin</code>.</li> <li>Next, within <code>Views/Checkin.js</code> work out how to set up a <code>handleSubmit</code> function that logs to the console the checkin.</li></ul> <div><h4> Click me for a hint</h4> <!----></div></div> <p>On completing the above task you will have seen that our check-in data looks like this:</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code> <span class="token punctuation">{</span>
        exercise<span class="token operator">:</span> <span class="token number">5</span>
        veg<span class="token operator">:</span> <span class="token number">3</span>
        water<span class="token operator">:</span> <span class="token number">2</span>
        diet<span class="token operator">:</span> <span class="token number">7</span>
        comment<span class="token operator">:</span> <span class="token string">&quot;test&quot;</span>
        total<span class="token operator">:</span> <span class="token number">20</span>
        drinkPen<span class="token operator">:</span> <span class="token string">&quot;1&quot;</span>
        foodPen<span class="token operator">:</span> <span class="token string">&quot;2&quot;</span>
    <span class="token punctuation">}</span>

</code></pre></div><p>The above data structure is close to resembling a document that could be stored in our database. However, look at our application's main dash, and you can see that we do not have enough information to display a check-in. For now, I am most concerned that we are missing a userName, userId and photo. This information needs to be added to our check-in object.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>You may think, why not just add a userId to our check-in and we could look the rest up. Remember, though, we are optimising for quick reads and data structures that resemble our UI. Yes, we are duplicating data; however, this idea, know as denormalisation, is fine in the NoSQL world.</p></div> <p>With the above in mind we want to create the following data structure:</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>
    <span class="token punctuation">{</span>
        exercise<span class="token operator">:</span> <span class="token number">5</span>
        veg<span class="token operator">:</span> <span class="token number">3</span>
        water<span class="token operator">:</span> <span class="token number">2</span>
        diet<span class="token operator">:</span> <span class="token number">7</span>
        comment<span class="token operator">:</span> <span class="token string">&quot;test&quot;</span>
        total<span class="token operator">:</span> <span class="token number">20</span>
        drinkPen<span class="token operator">:</span> <span class="token string">&quot;1&quot;</span>
        foodPen<span class="token operator">:</span> <span class="token string">&quot;2&quot;</span>
        <span class="token comment">// additional fields</span>
        photo<span class="token operator">:</span> <span class="token string">&quot;joephotourl&quot;</span>
        userName<span class="token operator">:</span> <span class="token string">&quot;joe appleton&quot;</span>
        userId<span class="token operator">:</span> <span class="token string">&quot;vDyPgsU41CMrFK29bmN4lULK6JN2&quot;</span><span class="token punctuation">,</span>
        time<span class="token operator">:</span> <span class="token string">&quot;Wed Mar 18 2020 10:03:31 GMT+0000 (Greenwich Mean Time)&quot;</span>
    <span class="token punctuation">}</span>

</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <h2 id="task-3-denormalisation-of-the-checkin-data"><a href="#task-3-denormalisation-of-the-checkin-data" class="header-anchor">#</a> Task 3 - Denormalisation of the checkin data</h2> <ul><li>Can you structure our current checkin object so it resembles our data structure above</li> <li>First, we need to grab the currently logged in user. We can do this by getting the <code>user</code> from our <code>useAuth</code> hook.</li></ul> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> useAuth <span class="token keyword">from</span> <span class="token string">&quot;../services/firebase/useAuth&quot;</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
<span class="token keyword">const</span> <span class="token function-variable function">Checkin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>You now have access to the user details</p></li> <li><p>There is a slight gotcha, if someone has signed up using email they may not have a userName in which case we want to use their email instead (users always have an email). In JavaScript, you can use the following technique to assign a default value:</p> <p><code>const userName = user.displayName || user.email</code>;</p></li></ul> <div><h4> Click me for a hint</h4> <!----></div></div> <ul><li>[Above, I am using the ES6 spread operator to combine the <code>checkin</code> object with a second, custom created, object. The second object contains the additional user details that we want to store alongside our checkin]</li></ul> <h2 id="reading-and-writing-to-our-database"><a href="#reading-and-writing-to-our-database" class="header-anchor">#</a> Reading and Writing to Our Database</h2> <h2 id="writing-data-to-firestore"><a href="#writing-data-to-firestore" class="header-anchor">#</a> Writing Data to Firestore</h2> <p>To use the firestore database in our application, we first need to import it.</p> <ul><li><p>Remember, we are following a design pattern where we use hooks to communicate with third-party services.</p></li> <li><p>With the above in mind, create a <code>src/services/firebase/useCheckin.js</code> file and add the following code:</p></li></ul> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  doc<span class="token punctuation">,</span>
  addDoc<span class="token punctuation">,</span>
  collection<span class="token punctuation">,</span>
  getDocs<span class="token punctuation">,</span>
 getFirestore
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;firebase/firestore&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">useCheckin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">getFirestore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">collection</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&quot;checkins&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">createCheckin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">checkin</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">addDoc</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> checkin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">getCheckins</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">getDocs</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>getCheckins<span class="token punctuation">,</span> createCheckin<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> useCheckin<span class="token punctuation">;</span>

</code></pre></div><p>Let's unpack what we are doing above:</p> <ul><li><p><code>const db = getFirestore();</code> gets a reference to our firestore database.</p></li> <li><p><code>const ref = collection(db, &quot;checkins&quot;);</code> is a pointer to a checkins collection in our database. If the collection does not exist it will be created when the first document is written to the collection</p></li> <li><p>We then use the above ref set up functions to add a new checkin <code>const createCheckin = (checkin) =&gt; addDoc(ref, checkin);</code> and also to read our all of the checkin documents from our collection <code>getCheckins = () =&gt; getDocs(ref);</code></p></li> <li><p>Finally, we return our functions so they can be used in other components: <code>return {getCheckins, createCheckin}</code></p></li></ul> <div class="custom-block tip"><p class="custom-block-title">task</p> <h2 id="task-4-make-your-first-database-write"><a href="#task-4-make-your-first-database-write" class="header-anchor">#</a> Task 4 - Make your first database write</h2> <p>This task requires us to create our first database write. We are going to be making a checkin. We are going to be working with <code>src/Views/Checkin.js</code> to enable this functionality.</p> <ul><li>Import the checkin hook: <code>import useCheckin from &quot;../services/firebase/useCheckin&quot;;</code></li> <li>Within your component invoke the hook and pull out the <code>createCheckin</code> function:</li></ul> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>    <span class="token keyword">const</span> <span class="token function-variable function">Checkin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>
       <span class="token keyword">const</span> <span class="token punctuation">{</span> createCheckin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useCheckin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">...</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>Now we can write a checkin to our database by simply passing the checkin object constructed on our <code>onSubmit</code> event into <code>createCheckin</code> hook function:</li></ul> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useHistory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">;</span>
<span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token keyword">const</span> <span class="token function-variable function">Checkin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token function">useHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token keyword">const</span> <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">checkin</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ckin <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>checkin<span class="token punctuation">,</span>
      <span class="token operator">...</span><span class="token punctuation">{</span>

        photo<span class="token operator">:</span> user<span class="token punctuation">.</span>photoURL<span class="token punctuation">,</span>
        userId<span class="token operator">:</span> user<span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
        userName<span class="token operator">:</span> user<span class="token punctuation">.</span>displayName <span class="token operator">||</span> user<span class="token punctuation">.</span>email<span class="token punctuation">,</span>
        time<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token function">createCheckin</span><span class="token punctuation">(</span>ckin<span class="token punctuation">)</span><span class="token punctuation">;</span>
       history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><ul><li>If the above worked, you should be redirected to the the dash <code>&quot;/&quot;</code> and have data in your database!</li></ul></div> <h2 id="reading-checkin-data"><a href="#reading-checkin-data" class="header-anchor">#</a> Reading Checkin Data</h2> <ul><li><p>Let's see if we can now read our checkins, we will do this in our top level <code>/Views/Dash.js</code>. I think this makes more sense over hosting the state up to our <code>src/App.js</code> component.</p></li> <li><p>First, we need to grab <code>getCheckins</code> from our <code>useCheckinHook</code>.</p></li> <li><p>Within <code>/Views/Dash.js</code> add <code>import useCheckin from &quot;./services/firebase/useCheckin&quot;;</code> to the top of your component.</p></li> <li><p>Then is your dash component pull out <code>getCheckins</code>, and set up some state to hold the checkins:</p></li></ul> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Dash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> getCheckins <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useCheckin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>checkins<span class="token punctuation">,</span> setCheckins<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

</code></pre></div><ul><li>We now need to consider when to call <code>getCheckins</code>. We want to do this when the component has rendered. The best way to do this is through using the <code>useEffect</code> hook.</li></ul> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
<span class="token keyword">function</span> <span class="token function">Dash</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token operator">...</span>
   <span class="token keyword">const</span> <span class="token function-variable function">getCheckinData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> checkinsSnap <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getCheckins</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> checkins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>checkinsSnap<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      checkinsSnap<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        checkins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>doc<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">{</span> id<span class="token operator">:</span> doc<span class="token punctuation">.</span>id <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setCheckins</span><span class="token punctuation">(</span>checkins<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">getCheckinData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token operator">...</span>
</code></pre></div><ul><li><p>Notice how I call the async function <code>getCheckinData</code>, this allows me to avoid making the <code>useEffect</code> function async. If I were to make my <code>useEffect</code> function <code>async</code> it would be placed on the event loop, and delay my function from rendering.</p></li> <li><p>A futher point of note, is I am reversing the checkins <code>checkins.reverse()</code> . This is so the latest checkin is show at the top of the dash. It is common, when using <code>Firebase</code> to make app level manipulations to data.</p></li></ul> <h2 id="home-study"><a href="#home-study" class="header-anchor">#</a> Home Study</h2> <div class="custom-block tip"><p class="custom-block-title">home study</p> <h2 id="task-5-display-the-checkin-data"><a href="#task-5-display-the-checkin-data" class="header-anchor">#</a> Task 5 - Display the checkin data</h2> <ul><li>Can you update the dash so it displays checkins from our database</li> <li>At the moment you will still need to use placeholder data for the histogram in the checkins, we'll solve this issue next week.</li></ul> <h2 id="task-7-advanced"><a href="#task-7-advanced" class="header-anchor">#</a> Task 7 (Advanced)</h2> <ul><li><p>Can you work out how to implement the comment functionality?</p></li> <li><p>This is a really interesting challenge. [You should consider using Firebase's realtime data update functionality[(https://firebase.google.com/docs/firestore/query-data/listen)].</p></li></ul></div> <h2 id="solution-video"><a href="#solution-video" class="header-anchor">#</a> Solution Video</h2> <iframe src="https://solent.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=b5259fc0-7fce-4bd8-8d7c-adea0082f06b&amp;autoplay=false&amp;offerviewer=true&amp;showtitle=true&amp;showbrand=false&amp;captions=true&amp;interactivity=all" height="405" width="720" allowfullscreen="allowfullscreen" allow="autoplay" style="border:1px solid #464646;"></iframe></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web-dev-2022-notes/sessions/week_9/lecture.html" class="prev">
        Lecture (Start Here)
      </a></span> <span class="next"><a href="/web-dev-2022-notes/sessions/week_10/">
        Week 10 - Hosting, Rules and Cloud Functions
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/web-dev-2022-notes/assets/js/app.533af2e4.js" defer></script><script src="/web-dev-2022-notes/assets/js/2.dc3a9f95.js" defer></script><script src="/web-dev-2022-notes/assets/js/17.d3da4c0b.js" defer></script><script src="/web-dev-2022-notes/assets/js/18.86fcf28e.js" defer></script>
  </body>
</html>
