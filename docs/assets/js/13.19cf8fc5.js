(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{380:function(t,e,a){t.exports=a.p+"assets/img/settings.10c2345c.png"},407:function(t,e,a){"use strict";a.r(e);var s=a(46),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"week-10-hosting-rules-and-cloud-functions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#week-10-hosting-rules-and-cloud-functions"}},[t._v("#")]),t._v(" Week 10 - Hosting, Rules and Cloud Functions")]),t._v(" "),s("p",[t._v("Welcome to week 10, our final week of formal delivery. This week we are going to consider the following:")]),t._v(" "),s("ul",[s("li",[t._v("How can I host my application?")]),t._v(" "),s("li",[t._v("How can I secure my database?")])]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("session dependencies=")]),t._v(" "),s("h2",{attrs:{id:"session-dependencies"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#session-dependencies"}},[t._v("#")]),t._v(" Session Dependencies")]),t._v(" "),s("p",[t._v("[Make sure that you have the latest of the ongoing class, fitness tracker, project. **The notes for this week refer extensively to this project:")]),t._v(" "),s("p",[s("code",[t._v("git clone -b week-9-solutions https://github.com/joeappleton18/running-contemp-web-app-solutions.git")])]),t._v(" "),s("p",[t._v("This week's, and future, setups are a little more involved. You will need to ensure that you add your own firebase credentials. The "),s("code",[t._v("README.md")]),t._v(" file on my version of the fitness tracker walks you through how to do this.")])]),t._v(" "),s("h3",{attrs:{id:"essential-reading"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#essential-reading"}},[t._v("#")]),t._v(" Essential Reading ðŸ“•")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("essential reading")]),t._v(" "),s("p",[t._v("The firebase documentation on:")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://firebase.google.com/docs/hosting",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hosting"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://firebase.google.com/docs/rules",target:"_blank",rel:"noopener noreferrer"}},[t._v("security rules"),s("OutboundLink")],1)])])]),t._v(" "),s("h2",{attrs:{id:"introduction"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[t._v("#")]),t._v(" Introduction")]),t._v(" "),s("p",[t._v("This week we are going to push things to the next level and make our application production-ready by securing our database. You will also learn how to deploy your application to hosting. To achieve all of this we will need to install the firebase command line interface.This is as far as we are going to take things! I appreciate our application is not finished. However, it's served its purpose in teaching you the basics of React and Firebase!")]),t._v(" "),s("h2",{attrs:{id:"getting-started-with-the-firebase-command-line-interface-cli"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#getting-started-with-the-firebase-command-line-interface-cli"}},[t._v("#")]),t._v(" Getting started with the Firebase Command Line Interface (CLI)")]),t._v(" "),s("p",[t._v('According to the documentation, "The Firebase CLI provides a variety of tools for managing, viewing, and deploying to Firebase projects". I have found it to be a powerful tool.')]),t._v(" "),s("p",[t._v("The Firebase CLI is simple to install:")]),t._v(" "),s("ul",[s("li",[t._v("First, ensure that you have Node.js v8.0.0 or later installed (this should be the case)")]),t._v(" "),s("li",[t._v("Next, from within a terminal or shell run "),s("code",[t._v("npm install -g firebase-tools")]),t._v(". The "),s("code",[t._v("-g")]),t._v(" option globally installs "),s("code",[t._v("npm")]),t._v(" packages.")])]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("If you are working on the university computers, you can't do global installs "),s("code",[t._v("npm install -g firebase-tools")]),t._v(".")])]),t._v(" "),s("li",[s("p",[t._v("Instead, you will need to install the firebase cli locally: "),s("code",[t._v("npm install -D firebase-tools")])])]),t._v(" "),s("li",[s("p",[t._v("Next, wherever I say run the "),s("code",[t._v("firebase")]),t._v(" command pre-append "),s("code",[t._v("npx")]),t._v(" (e.g., "),s("code",[t._v("firebase login")]),t._v(" becomes "),s("code",[t._v("npx firebase login")]),t._v(")")])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("::tip")]),t._v(" "),s("h2",{attrs:{id:"task-1-getting-started-with-the-cli-and-deploying-to-hosting"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#task-1-getting-started-with-the-cli-and-deploying-to-hosting"}},[t._v("#")]),t._v(" Task 1 - Getting Started with the CLI and Deploying to Hosting")]),t._v(" "),s("p",[s("img",{attrs:{src:a(380),alt:""}}),t._v("\n0.  To use the latest version of the CLI, you'll need to set the "),s("code",[t._v("Default GCP resource location")]),t._v(" from your project's settings in the firebase dashboard.")]),t._v(" "),s("ol",[s("li",[t._v("Use the steps above to install the CLI")]),t._v(" "),s("li",[t._v("Within the terminal authenticate the CLI by running "),s("code",[t._v("firebase login")])]),t._v(" "),s("li",[t._v("Next, within the terminal, navigate to the root of your goal tracking application and run "),s("code",[t._v("firebase init")]),t._v(".")])]),t._v(" "),s("p",[t._v("The video below that walks you through setting up the CLI products that we need, press space to select things. When prompted, you will need to make sure that you select the firebase project that contains your goal tracking application.")]),t._v(" "),s("iframe",{staticStyle:{border:"1px solid #464646"},attrs:{src:"https://solent.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=d38c636e-ff2c-4ac0-ae7b-ab8700c9e84b&autoplay=false&offerviewer=true&showtitle=true&showbrand=false&start=0&interactivity=all",width:"720",height:"405",allowfullscreen:"",allow:"autoplay"}}),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("We are now ready to deploy our application to the firebase hosting:")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("First, create a production build of your project, "),s("code",[t._v("npm run build")]),t._v("\nAfter this command has run you should see a 'build' folder containing your production-ready application.")])]),t._v(" "),s("li",[s("p",[t._v("Next, deploy the project to firebase hosting, you simply need to run the command "),s("code",[t._v("firebase deploy --only hosting")])])]),t._v(" "),s("li",[s("p",[t._v("That's it! If all has worked, your application should have been deployed to its own custom URL. You may want to add the hosting deployment command, and further commands you use, to your scripts object in your "),s("code",[t._v("package.json")]),t._v(" file.")])])]),t._v(" "),s("h2",{attrs:{id:"securing-your-firebase-database"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#securing-your-firebase-database"}},[t._v("#")]),t._v(" Securing your Firebase Database")]),t._v(" "),s("p",[t._v("Currently our database is not locked down and users can perform any operation they like. To solve this problem, we can use firebase security rules to secure our database.")]),t._v(" "),s("p",[t._v("Firebase rules are written in a simple language called Common Expression Language (CEL). Luckily, CEL is similar to JavaScript, albeit somewhat more limiting.")]),t._v(" "),s("p",[t._v("Your projects rules are stored in the "),s("code",[t._v("firestore.rules")]),t._v(" file. Currently, your application is not locked down. Replace the existing rules with the following code snippet:")]),t._v(" "),s("div",{staticClass:"language-JavaScript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("\nrules_version "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nservice cloud"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firestore "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  match "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("databases"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("database"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("documents "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    match "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("document"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          allow read"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" write"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("p",[t._v("The above code is an example ensures that only logged in users can read/write to our database. Let's explore what is going on above:")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("First, we use the wild card to match all documents "),s("code",[t._v("{document=**}")]),t._v(".")])]),t._v(" "),s("li",[s("p",[t._v("We then list the operations that we want to allow - "),s("code",[t._v("allow read, write")]),t._v(". You should note that write captures - create, update and delete.")])]),t._v(" "),s("li",[s("p",[t._v("Finally, we set a condition, "),s("code",[t._v("if request.auth.uid != null;")]),t._v(", should this condition resolve to true the operation is allowed.")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("request")]),t._v(" is a global var that firebase makes available to us. If "),s("code",[t._v("request.auth.uid != null;")]),t._v(" is set then the user is logged-in.")])]),t._v(" "),s("li",[s("p",[t._v("We can deploy our new updated rules by running: "),s("code",[t._v("firebase deploy --only firestore:rules")]),t._v(".")])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("h2",{attrs:{id:"task-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#task-2"}},[t._v("#")]),t._v(" Task 2")]),t._v(" "),s("ul",[s("li",[t._v("Using the steps above secure your database so only logged in users can read and write to your database")]),t._v(" "),s("li",[t._v("From within the database section in your firebase project, click on the rules tab - these rules should mirror your local version")]),t._v(" "),s("li",[t._v('See if you can figure out how to test if your rules work. You can use the "rules playground" to see if this the case')])])]),t._v(" "),s("h2",{attrs:{id:"increasing-the-granularity-of-our-rules"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#increasing-the-granularity-of-our-rules"}},[t._v("#")]),t._v(" Increasing the granularity of our rules")]),t._v(" "),s("p",[t._v("Currently, our application is wide-open to any logged-in user. This is only slightly better than having no authentication at all. Luckily, firebase allows us to protect each collection and sub-collection on a granular level - it even affords us the ability to evaluate the incoming data and, for complex rules, access other documents. Let's explore some of these ideas to make our database more secure:")]),t._v(" "),s("div",{staticClass:"language-JavaScript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("\nrules_version "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nservice cloud"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firestore "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  match "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("databases"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("database"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("documents "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    match "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("checkins"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("checkin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      allow read"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      allow write "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userId "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uid   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// users can only check themselves in")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[s("p",[t._v("In the above example, we lock down down documents on a collection-by-collection basis. Notice how we can access the incoming data, "),s("code",[t._v("request.resource.data.userId == request.auth.uid")]),t._v(". This ensures that a user can only check themselves in. However, any logged-in user can read the data.")])]),t._v(" "),s("li",[s("p",[t._v("Finally, the only other collection we need to consider is comments. Comments are interesting as they are a sub-collection of a checkin document. To begin with let's make all documents within a comments collection insecure. Notice how we nest the rule for a sub-collection within its parent collection:")])])]),t._v(" "),s("div",{staticClass:"language-JavaScript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    match "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("checkins"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("checkin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      allow read"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      allow write "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userId "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// users can only create a checkin for themselves")]),t._v("\n\n      match "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("comments"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("comment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        allow read"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" write"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Let's now consider how we can secure our comments sub collection - we have two choices here. However, first, let's understand what we are looking to achieve with our security rules.")]),t._v(" "),s("ul",[s("li",[t._v("Just like with our checkin documents, we only want users to be able to create comments under their own user id")]),t._v(" "),s("li",[t._v("Any logged-in user can view comments")])]),t._v(" "),s("p",[t._v("Our first solution would be to simply duplicate the logic that we have already used for the parent checkin collection:")]),t._v(" "),s("div",{staticClass:"language-JavaScript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    match "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("checkins"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("checkin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      allow read"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      allow write "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userId "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// users can only create a checkin for themselves")]),t._v("\n\n      match "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("comments"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("comment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        allow read"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        allow write "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userId "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("The above solution is fine; however, since the sub-collection shares the same rules as its parent, another solution would be to create a wildcard that cascades the parent rules downwards:")]),t._v(" "),s("div",{staticClass:"language-JavaScript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    match "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("checkins"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("document"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      allow read"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      allow write "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userId "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// users a can only create a checkin and a comment for themselves")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("In this instance, I prefer the latter approach. However, since each further sub-collection will inherit the parent security rules, we must use it with caution.")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("h2",{attrs:{id:"task-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#task-3"}},[t._v("#")]),t._v(" Task 3")]),t._v(" "),s("p",[t._v("Use the techniques coved above to secure your database.")])])])}),[],!1,null,null,null);e.default=n.exports}}]);